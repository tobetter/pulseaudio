Index: pulseaudio-0.9.13/src/modules/module-alsa-sink.c
===================================================================
--- pulseaudio-0.9.13.orig/src/modules/module-alsa-sink.c	2009-01-08 19:00:18.000000000 -0500
+++ pulseaudio-0.9.13/src/modules/module-alsa-sink.c	2009-01-08 19:01:35.000000000 -0500
@@ -581,9 +581,9 @@
             u->hwbuf_unused_frames = (snd_pcm_sframes_t)
                 (PA_LIKELY(b < u->hwbuf_size) ?
                  ((u->hwbuf_size - b) / u->frame_size) : 0);
-
-            fix_tsched_watermark(u);
         }
+
+        fix_tsched_watermark(u);
     }
 
     pa_log_debug("hwbuf_unused_frames=%lu", (unsigned long) u->hwbuf_unused_frames);
Index: pulseaudio-0.9.13/src/modules/module-alsa-source.c
===================================================================
--- pulseaudio-0.9.13.orig/src/modules/module-alsa-source.c	2009-01-08 19:00:33.000000000 -0500
+++ pulseaudio-0.9.13/src/modules/module-alsa-source.c	2009-01-08 19:01:35.000000000 -0500
@@ -527,9 +527,9 @@
             u->hwbuf_unused_frames = (snd_pcm_sframes_t)
                 (PA_LIKELY(b < u->hwbuf_size) ?
                  ((u->hwbuf_size - b) / u->frame_size) : 0);
-
-            fix_tsched_watermark(u);
         }
+
+        fix_tsched_watermark(u);
     }
 
     pa_log_debug("hwbuf_unused_frames=%lu", (unsigned long) u->hwbuf_unused_frames);
Index: pulseaudio-0.9.13/src/modules/module-null-sink.c
===================================================================
--- pulseaudio-0.9.13.orig/src/modules/module-null-sink.c	2009-01-08 19:00:33.000000000 -0500
+++ pulseaudio-0.9.13/src/modules/module-null-sink.c	2009-01-08 19:01:35.000000000 -0500
@@ -73,8 +73,6 @@
     pa_thread_mq thread_mq;
     pa_rtpoll *rtpoll;
 
-    size_t block_size;
-
     pa_usec_t block_usec;
     pa_usec_t timestamp;
 };
@@ -89,7 +87,13 @@
     NULL
 };
 
-static int sink_process_msg(pa_msgobject *o, int code, void *data, int64_t offset, pa_memchunk *chunk) {
+static int sink_process_msg(
+        pa_msgobject *o,
+        int code,
+        void *data,
+        int64_t offset,
+        pa_memchunk *chunk) {
+
     struct userdata *u = PA_SINK(o)->userdata;
 
     switch (code) {
@@ -104,7 +108,7 @@
             pa_usec_t now;
 
             now = pa_rtclock_usec();
-            *((pa_usec_t*) data) = u->timestamp > now ? u->timestamp - now : 0;
+            *((pa_usec_t*) data) = u->timestamp > now ? u->timestamp - now : 0ULL;
 
             return 0;
         }
@@ -117,10 +121,12 @@
     struct userdata *u;
 
     pa_sink_assert_ref(s);
-    u = s->userdata;
-    pa_assert(u);
+    pa_assert_se(u = s->userdata);
 
     u->block_usec = pa_sink_get_requested_latency_within_thread(s);
+
+    if (u->block_usec == (pa_usec_t) -1)
+        u->block_usec = s->thread_info.max_latency;
 }
 
 static void process_rewind(struct userdata *u, pa_usec_t now) {
Index: pulseaudio-0.9.13/src/modules/module-pipe-source.c
===================================================================
--- pulseaudio-0.9.13.orig/src/modules/module-pipe-source.c	2009-01-08 19:00:58.000000000 -0500
+++ pulseaudio-0.9.13/src/modules/module-pipe-source.c	2009-01-08 19:01:35.000000000 -0500
@@ -226,10 +226,9 @@
         goto fail;
     }
 
-    u = pa_xnew0(struct userdata, 1);
+    m->userdata = u = pa_xnew0(struct userdata, 1);
     u->core = m->core;
     u->module = m;
-    m->userdata = u;
     pa_memchunk_reset(&u->memchunk);
     u->rtpoll = pa_rtpoll_new();
     pa_thread_mq_init(&u->thread_mq, m->core->mainloop, u->rtpoll);
@@ -264,7 +263,7 @@
     pa_source_new_data_set_sample_spec(&data, &ss);
     pa_source_new_data_set_channel_map(&data, &map);
 
-    u->source = pa_source_new(m->core, &data, 0);
+    u->source = pa_source_new(m->core, &data, PA_SOURCE_LATENCY);
     pa_source_new_data_done(&data);
 
     if (!u->source) {
Index: pulseaudio-0.9.13/src/modules/module-sine.c
===================================================================
--- pulseaudio-0.9.13.orig/src/modules/module-sine.c	2009-01-08 19:00:59.000000000 -0500
+++ pulseaudio-0.9.13/src/modules/module-sine.c	2009-01-08 19:01:35.000000000 -0500
@@ -41,7 +41,9 @@
 PA_MODULE_DESCRIPTION("Sine wave generator");
 PA_MODULE_VERSION(PACKAGE_VERSION);
 PA_MODULE_LOAD_ONCE(FALSE);
-PA_MODULE_USAGE("sink=<sink to connect to> frequency=<frequency in Hz>");
+PA_MODULE_USAGE(
+        "sink=<sink to connect to> "
+        "frequency=<frequency in Hz>");
 
 struct userdata {
     pa_core *core;
