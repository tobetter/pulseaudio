Description: use bind_now directly instead of attempting a re-exec (CVE-2009-1894).

Index: pulseaudio-0.9.10/src/Makefile.am
===================================================================
--- pulseaudio-0.9.10.orig/src/Makefile.am	2009-07-13 16:37:19.000000000 -0700
+++ pulseaudio-0.9.10/src/Makefile.am	2009-07-13 16:37:54.000000000 -0700
@@ -147,9 +147,9 @@
 endif
 
 if FORCE_PREOPEN
-pulseaudio_LDFLAGS = $(AM_LDFLAGS) $(BINLDFLAGS) -dlpreopen force $(foreach f,$(PREOPEN_LIBS),-dlpreopen $(f))
+pulseaudio_LDFLAGS = $(AM_LDFLAGS) $(BINLDFLAGS) -dlpreopen force $(foreach f,$(PREOPEN_LIBS),-dlpreopen $(f)) -Wl,-z,now
 else
-pulseaudio_LDFLAGS = $(AM_LDFLAGS) $(BINLDFLAGS) -dlopen force $(foreach f,$(PREOPEN_LIBS),-dlopen $(f))
+pulseaudio_LDFLAGS = $(AM_LDFLAGS) $(BINLDFLAGS) -dlopen force $(foreach f,$(PREOPEN_LIBS),-dlopen $(f)) -Wl,-z,now
 endif
 
 if HAVE_POLKIT
Index: pulseaudio-0.9.10/src/Makefile.in
===================================================================
--- pulseaudio-0.9.10.orig/src/Makefile.in	2009-07-13 16:37:19.000000000 -0700
+++ pulseaudio-0.9.10/src/Makefile.in	2009-07-13 16:38:11.000000000 -0700
@@ -2118,8 +2118,8 @@
 pulseaudio_DEPENDENCIES = libpulsecore.la $(PREOPEN_LIBS)
 @PREOPEN_MODS_FALSE@PREOPEN_LIBS = $(modlibexec_LTLIBRARIES)
 @PREOPEN_MODS_TRUE@PREOPEN_LIBS = $(PREOPEN_MODS)
-@FORCE_PREOPEN_FALSE@pulseaudio_LDFLAGS = $(AM_LDFLAGS) $(BINLDFLAGS) -dlopen force $(foreach f,$(PREOPEN_LIBS),-dlopen $(f))
-@FORCE_PREOPEN_TRUE@pulseaudio_LDFLAGS = $(AM_LDFLAGS) $(BINLDFLAGS) -dlpreopen force $(foreach f,$(PREOPEN_LIBS),-dlpreopen $(f))
+@FORCE_PREOPEN_FALSE@pulseaudio_LDFLAGS = $(AM_LDFLAGS) $(BINLDFLAGS) -dlopen force $(foreach f,$(PREOPEN_LIBS),-dlopen $(f)) -Wl,-z,now
+@FORCE_PREOPEN_TRUE@pulseaudio_LDFLAGS = $(AM_LDFLAGS) $(BINLDFLAGS) -dlpreopen force $(foreach f,$(PREOPEN_LIBS),-dlpreopen $(f)) -Wl,-z,now
 @HAVE_POLKIT_TRUE@policy_DATA = daemon/org.pulseaudio.policy
 bin_SCRIPTS = esdcompat $(am__append_21)
 pacat_SOURCES = utils/pacat.c
Index: pulseaudio-0.9.10/src/daemon/main.c
===================================================================
--- pulseaudio-0.9.10.orig/src/daemon/main.c	2009-07-13 16:37:19.000000000 -0700
+++ pulseaudio-0.9.10/src/daemon/main.c	2009-07-13 16:37:36.000000000 -0700
@@ -342,25 +342,6 @@
 #endif
 
 
-#if defined(__linux__) && defined(__OPTIMIZE__)
-    /*
-       Disable lazy relocations to make usage of external libraries
-       more deterministic for our RT threads. We abuse __OPTIMIZE__ as
-       a check whether we are a debug build or not.
-    */
-
-    if (!getenv("LD_BIND_NOW")) {
-        char *rp;
-
-        /* We have to execute ourselves, because the libc caches the
-         * value of $LD_BIND_NOW on initialization. */
-
-        putenv(pa_xstrdup("LD_BIND_NOW=1"));
-        pa_assert_se(rp = pa_readlink("/proc/self/exe"));
-        pa_assert_se(execv(rp, argv) == 0);
-    }
-#endif
-
 #ifdef HAVE_GETUID
     real_root = getuid() == 0;
     suid_root = !real_root && geteuid() == 0;
